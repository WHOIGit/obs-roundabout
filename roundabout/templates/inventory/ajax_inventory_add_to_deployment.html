
{% load static i18n %}
{% load common_tags %}
{% load inventory_tags %}
{% load mptt_tags %}


            <div class="card">
                <div class="card-header">

                    <h3>Add to Deployment</h3>


                    <p>{% if inventory_item.part.friendly_name %} {{ inventory_item.part.friendly_name}} {% else %} {{ inventory_item.part.name }} {% endif %}
                        - {{ inventory_item.serial_number }}</p>

                </div>

                <div class="card-body">

                    <p>The following Deployment destinations are available for this Part.</p>


                    <div id="available-mooring-parts">
                    {% if deployments %}
                        {% regroup deployments by location as deployments_by_location %}
                        {% for location in deployments_by_location %}
                            <h5 class="mt-3">{{ location.grouper.get_ancestors|tree_path:" > " }} > {{ location.grouper }}</h5>
                            {%  for dep in location.list %}

                                <div class="card">
                                    <div class="card-header" id="heading-{{ dep.id }}">
                                      <h5 class="mb-0">
                                        <button class="btn btn-link" data-toggle="collapse" data-target="#collapse-{{ dep.id  }}" aria-expanded="true" aria-controls="collapse-{{ dep.id  }}">
                                            <b>{{ dep.deployment_number }} ({{ dep.final_location.location_id }})
                                                {% if dep.current_deployment_status == 'burnin' %}<span class="badge badge-pill badge-danger">Burn In</span>{% endif %}
                                                {% if dep.current_deployment_status == 'create' %}<span class="badge badge-pill badge-success">Initial Build</span>{% endif %}
                                            </b>
                                        </button>
                                      </h5>
                                    </div>

                                    <div id="collapse-{{ dep.id  }}" class="collapse" aria-labelledby="heading-{{ dep.id  }}" data-parent="#available-mooring-parts">
                                      <div class="card-body ajax-add-subassembly-link">
                                          <ul class="list-group list-group-flush">
                                              {% for mooring_part in mooring_parts %}
                                                  {% if mooring_part.location == dep.final_location %}
                                                   <li class="list-group-item">

                                                      {{ mooring_part.get_ancestors|tree_path:" > " }} > <span class="text-primary">{{ mooring_part }}</span>
                                                      {% if mooring_part.get_children %} > {{ mooring_part.get_children|tree_path:" :: " }} {% endif %}

                                                        <!-- Get dictionary of current Inventory IDs for this Deployment, check if Mooring Part is filled -->
                                                      {% get_inventory_dictionary dep.inventory as inventory_dict %}

                                                          {% if mooring_part.id in inventory_dict %}
                                                              <button type="button" class="btn btn-dark btn-sm float-right" disabled>Filled</button>
                                                          {% else %}
                                                          <a href="#" data-detail-url="{% url 'inventory:ajax_inventory_add_to_deployment_action' inventory_item.id dep.id mooring_part.id %}"
                                                              data-mooring-id="{{ mooring_part.id }}"
                                                              data-node-id="{{ inventory_item.id }}"
                                                              class="btn btn-primary btn-sm float-right"
                                                              role="button">Select </a>

                                                          {% endif %}


                                                    </li>


                                                    {% endif %}

                                              {% endfor %}

                                           </ul>
                                      </div>
                                    </div>
                                </div>

                            {% endfor %}
                        {% endfor %}

                    {% else %}
                        <p>NONE</p>
                    {% endif %}



                  </div>

                </div>


{% block javascript %}


{% endblock javascript %}
