<!--
# Copyright (C) 2019-2020 Woods Hole Oceanographic Institution
#
# This file is part of the Roundabout Database project ("RDB" or
# "ooicgsn-roundabout").
#
# ooicgsn-roundabout is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 2 of the License, or
# (at your option) any later version.
#
# ooicgsn-roundabout is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with ooicgsn-roundabout in the COPYING.md file at the project root.
# If not, see <http://www.gnu.org/licenses/>.
-->
{% load common_tags %}
{% load inventory_tags %}

<a class="collapsed" data-toggle="collapse" href="#deployment-{{ deployment_event.id }}" aria-expanded="false" aria-controls="deployment-{{ deployment_event.id }}">
    {{ deployment_event.build.build_number }} - {{ label_deployments_app_singular }}: {{ deployment_event.deployment }}
</a>

<a data-toggle="collapse" class="collapsed text-right" href="#deployment-{{ deployment_event.id }}" aria-controls="deployment-{{ deployment_event.id }}" aria-expanded="false" role="button">
    <i class="fa" aria-hidden="true"></i>
    <span class="sr-only">Expand/Collapse Revision {{ deployment }}</span>
</a>
<div class="progress" style="height: 20px;">
    <div class="progress-bar {{ deployment_event.deployment.get_deployment_progress_bar|get_item:'bar_class' }}" role="progressbar" style="width: {{ deployment_event.deployment.get_deployment_progress_bar|get_item:'bar_width' }}%;" aria-valuenow="{{ deployment_event.deployment.get_deployment_progress_bar|get_item:'bar_width' }}" aria-valuemin="0" aria-valuemax="100">
        <span>{{ deployment.get_deployment_status_label }}</span>
    </div>
</div>

<div class="collapse mt-3" id="deployment-{{ deployment_event.id }}">

    <p>Build:
        <a href="{% url 'builds:builds_detail' deployment_event.build.id %}">{{ deployment_event.build }}</a>
    </p>

    <p>{{ label_deployments_app_singular }} Location: {{ deployment_event.location }}</p>

    <p>Time on Deployment: {% get_deployment_data inventory_item deployment_event %}

    {% if deployment_event.deployment.get_deploytosea_details %}
        <p>{{ label_deployments_app_singular }} Date: {{ deployment_event.deployment.get_deploytosea_details|get_item:'deploy_date' }}</p>
    {% endif %}

    {% if deployment_event.cruise %}
        <p>Cruise Deployed On:
            <a href="{% url 'cruises:cruises_detail' deployment_event.cruise.id %}">{{ deployment_event.cruise}}</a>
        </p>
    {% endif %}

    {% if deployment_event.deployment.cruise_recovered %}
        <p>Cruise Recovered On:
            <a href="{% url 'cruises:cruises_detail' deployment_event.deployment.cruise_recovered.id %}">{{ deployment_event.deployment.cruise_recovered }}</a>
        </p>
    {% endif %}

    {% if deployment_event.eployment.get_deployment_time_at_sea %}
        <p>Total Time at Sea: {{ deployment_event.deployment.get_deployment_time_at_sea|time_at_sea_display }}
    {% endif %}

    <table class="table table-striped action-table">
        <thead>
          <th>Date</th>
          <th>Action</th>
          <th>Details</th>
          <th>Person</th>
          <th>Location</th>

        </thead>
        <tbody>
          {% for action in deployment_event.deployment.deployment_actions.all %}
            <tr>
                <td>{{ action.created_at|date:"n/j/y H:i" }}</td>
                <td>{{ action.get_action_type_display }}</td>
                <td>
                    {{ action.detail|safe }}
                </td>
                <td>{{ action.user.username }}</td>
                <td>{{ action.location.name }}</td>
            </tr>
          {% endfor %}
        </tbody>
  </table>
</div>
