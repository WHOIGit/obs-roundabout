<!--
# Copyright (C) 2019-2020 Woods Hole Oceanographic Institution
#
# This file is part of the Roundabout Database project ("RDB" or
# "ooicgsn-roundabout").
#
# ooicgsn-roundabout is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 2 of the License, or
# (at your option) any later version.
#
# ooicgsn-roundabout is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with ooicgsn-roundabout in the COPYING.md file at the project root.
# If not, see <http://www.gnu.org/licenses/>.
-->

{% extends "base.html" %}
{% load static i18n %}
{% load mptt_tags %}
{% load crispy_forms_tags %}
{% load render_table from django_tables2 %}
{% block title %}Adv. Search{% endblock %}
{% block javascript %}
  <script type="text/javascript" src="/static/js/form-search.js"></script>
  <script>window.addEventListener("load", function(){
    const model = '{{ model }}'

    {% if prev_cards %}
      $("#adv-search-cards").empty()
      const prev_cards = jQuery.parseJSON('{{ prev_cards|escapejs }}')
      for( let card in prev_cards ){
          insert_card(model,prev_cards[card])
      }

    {% else %}
      insert_card(model)
    {% endif %}

  })</script>
{% endblock javascript %}
{% block content %}


<div class="row">

  <!-- SEARCH CONTROLS -->
  <div class="col-md-5 search-control">
    <h2>Search: {{ model }}</h2>
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Search for... {{ model }}
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <a class="dropdown-item" href={% url 'search:inventory' %}>Inventory</a>
          <a class="dropdown-item" href={% url 'search:part' %}>Part</a>
          <a class="dropdown-item" href={% url 'search:build' %}>Build</a>
          <a class="dropdown-item" href={% url 'search:assembly' %}>Assembly</a>
        </div>
      </div>

    <form id='adv-search-form' method="get" accept-charset="utf-8" class="form">

      <div id='adv-search-cards'>  </div>

      <button class="btn btn-primary float-left m-1" type="button" onclick="insert_card('{{ model }}')"><i class="fa fa-plus"></i> New Card</button>
      <button class="btn btn-primary float-right m-1" type="submit"><i class="fa fa-search"></i> Submit</button>
      <a href="{{ self_url }}"><button type='button' class="btn btn-primary float-right m-1">RESET</button></a>
    </form>
  </div>


  <!-- LISTVIEW -->
  <div class="col-md-7 search-results">
    <div class="card" id="search-list-view">
      <div class="card-header">
        <h3>Search Results</h3>
      </div>
      <div class="card-body">

        {% if query_slug %}
        <form action="{% url 'search:csv' model query_slug %}" method="get">
          <button class="button float-right" type="submit">Download CSV</button>
        </form>
        {% endif %}

        {% if table %}
          <p><b>{{ table.paginator.count }}</b> items match your search!</p>
          {% render_table table %}
        {% endif %}

      </div>
    </div>
  </div>
</div>

{% endblock content %}
