// JavaScript source code
'use strict';
console.log('Running Retire Builds Test');

// Generated by Selenium IDE
const { Builder, By, Key, until, a, WebElement, promise } = require('selenium-webdriver');
const chrome = require('selenium-webdriver/chrome');
const assert = require('assert');
const chromedriver = require('chromedriver');
const { exception } = require('console');

var driver;

(async function retireBuilds() {

    driver = new Builder().forBrowser('chrome').build();

    // Step # | name | target | value
    // 1 | open | https://ooi-cgrdb-staging.whoi.net/ | 
    await driver.get("https://ooi-cgrdb-staging.whoi.net/");
    // 2 | setWindowSize | 1304x834 | 
    await driver.manage().window().setRect(1304, 834);
    // Set implict wait time in between steps
    await driver.manage().setTimeouts({ implicit: 20000 });

    try {

        // LOGIN
        await driver.findElement(By.linkText("Sign In")).click();
        await driver.findElement(By.id("id_login")).sendKeys("jkoch");
        await driver.findElement(By.id("id_password")).sendKeys("Automatedtests");
        await driver.findElement(By.css(".primaryAction")).click();

        // RETIRE BUILDS TEST

        // Retire Builds added during the Add Builds test.
        await driver.findElement(By.linkText("Builds")).click();
        var j = (await driver.findElements(By.xpath(".//*[contains(text(),'Test')]/preceding-sibling::*"))).length + 1;
        await driver.findElement(By.xpath("//div/ul/li[" + j + "]/i")).click();
        await driver.findElement(By.xpath("//div/ul/li[" + j + "]/ul/li/i")).click();
        // 8 | click | linkText=Test Child |
        await driver.wait(until.elementLocated(By.partialLinkText("Test Glider 1")));
        await driver.findElement(By.partialLinkText("Test Glider 1")).click();

        await driver.findElement(By.linkText("Retire Build")).click();
        // 20 | click | id=id_detail | 
        await driver.findElement(By.id("id_detail")).click();
        // 21 | type | id=id_detail | Retiring for automated testing.
        await driver.findElement(By.id("id_detail")).sendKeys("Retiring for automated testing.");
        // 22 | click | css=.controls > .btn | 
        await driver.findElement(By.css(".controls > .btn")).click(); 

    }
    catch (e) {
        console.log(e.message, e.stack);
        console.log("Retire Builds failed.");
        throw (e);
    }
    console.log("Retire Builds completed.")
    return;

})();
